---
title: "a4_task2_katelyn_toigo"
author: "Katelyn Toigo"
date: "11/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(janitor)
library(here)
library(kableExtra)
library(ggbeeswarm)
library(effsize)
library(broom)
```

## Introduction

....

## Data and Analyses

....

## Exploratory findings
### Annual juvenile hare trap counts

```{r, echo=FALSE, message=FALSE, warning=FALSE}
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
juv_year <- bonanza_hares %>% 
  filter(age == "j") %>% 
  select(grid, date, age) %>% 
  mutate(date_new = mdy(date)) %>% 
  mutate(year = year(date_new)) %>% 
  group_by(year) %>% 
  count(age == "j")
  
ggplot(data = juv_year, aes(x = year, y = n)) +
  geom_point() +
  geom_line() +
  labs(title = "Juvenile Hares Caught by Year", x = "Year", y = "Number of Juveniles")
```

**Figure 1.** The number of juvenile hares captured each year at Bonanza Black Spruce, Bonanza Mature, and Bonanza Riparian. Data: Kielland, Chapin, Ruess (2017).

The maximum number of juvenile hares were captured in 1999, and the number of juveniles captured decreased every year until 2004 after this. The minimum number caught in one year were in 2010. The number captured tended to fluctuate.  The number captured each year also depends on the amount of sampling. If sampling cannot be consistent, it might be better to compare data that is standardized (such as number of juveniles caught by day) before comparing the years.


### Visualize juvenile hare weights

```{r, echo=FALSE, message=FALSE, warning=FALSE}
weights_sex_viz <- bonanza_hares %>% 
  select(grid, sex, weight, age) %>% 
  filter(age == "j")

weights_sex_viz$grid[weights_sex_viz$grid == "bonbs"] <- "Bonanza Black Spruce"
weights_sex_viz$grid[weights_sex_viz$grid == "bonmat"] <- "Bonanza Mature"
weights_sex_viz$grid[weights_sex_viz$grid == "bonrip"] <- "Bonanza Riparian"

weights_sex_viz$sex[weights_sex_viz$sex == "f"] <- "Female"
weights_sex_viz$sex[weights_sex_viz$sex == "m"] <- "Male"
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = weights_sex_viz, aes(x=sex, y=weight)) + 
  geom_beeswarm(aes(color = sex)) +
  facet_wrap(~grid)+
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=mean, 
               geom="point", 
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  labs(title = "Sex vs. Weight Comparison for Juvenile Snowshoe Hares", x="Sex", y="Weight (grams)")
```

**Figure 2.** Sex versus weight (grams) comparisons for juvenile snowshoe hares at three sites: Bonanza Black Spruce, Bonanza Mature, and Bonanza Riparian. Red (female), teal (male) and grey (NA - unidentified as male or female) points indicate individual observations for weight (grams) of juvenile snowshow hares. Box endpoints indicate the 25^th^ and 75^th^ percentile values; the black line and black point within the box indicate the median and mean value for each species, respectively. Data: Kielland, Chapin, Ruess (2017).  

The mean weight of males at all three sites is, on average, greater than females and hares without a sex identification, though not by much.  The greatest difference can be seen in the Bonanza Riparian site between male weight and NA weight.  There were no juveniles caught at Bonanza Black Spruce that did not have a sex identified.


### Juvenile weight comparison (male and female snowshoe hares)

**Table 1.** Descriptive statistics (mean, standard deviation, and sample size) for male and female juvenile snowshoe hares. Data: Kielland, Chapin, Ruess (2017).

```{r, echo=FALSE, message=FALSE, warning=FALSE}
juv_hare_table <- weights_sex_viz %>% 
  na.omit(sex) %>% 
  group_by(sex) %>% 
  summarize(
    mean_weight = round(mean(weight, na.rm = TRUE),2),
    sd_weight = round(sd(weight, na.rm = TRUE),2),
    n = n())

juv_hare_table %>% 
  kable(col.names = c("Sex", "Mean weight (g)", "Standard deviation (g)", "Sample size")) %>% 
  kable_styling(bootstrap_options = "striped", full_width = FALSE)
```


```{r, include = FALSE}
ws_withoutna <- weights_sex_viz %>% 
  na.omit(sex)

female_sample <- ws_withoutna %>% 
  filter(sex == "Female") %>% 
  pull(weight)

male_sample <- ws_withoutna %>% 
  filter(sex == "Male") %>% 
  pull(weight)
```

```{r, include = FALSE}
hare_ttest <- t.test(female_sample, male_sample)
hare_effsize <- cohen.d(female_sample, male_sample)

hare_ttest
hare_effsize
```

```{r, include = FALSE}
female_mean <- mean(female_sample)
male_mean <- mean(male_sample)
female_sd <- sd(female_sample)
male_sd <- sd(male_sample)

hare_ttest_tidy <- tidy(hare_ttest)

female_sd
male_sd
```


```{r, include = FALSE}
ggplot(data = ws_withoutna, aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~sex) +
  labs(x = "Weight (g)", y = "Count")

ggplot(data = ws_withoutna, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)
```

On average, juvenile male snowshoe hares have a higher weight than juvenile female hares (`r round(male_mean,2)` $\pm$ `r round(male_sd, 2)` and `r round(female_mean,2)` $\pm$ `r round(female_sd, 2)` g, respectively; mean $\pm$ 1 standard deviation). While the absolute difference in means is `r round(male_mean, 2) - round(female_mean, 2)` g (a `r round((male_mean - female_mean)/((male_mean + female_mean)/2)*100, 2)`% difference), the difference in means is significant (Welch's two-sample t-test: t(`r round(hare_ttest_tidy$parameter,2)`) = `r round(hare_ttest_tidy$statistic,2)`, p < 0.001), and the effect size is small (Cohen's *d* = `r round(hare_effsize$estimate,2)`).



### Relationship between juvenile weight and hind foot length

```{r, echo=FALSE, message=FALSE, warning=FALSE}
j_hares <- bonanza_hares %>% 
  filter(age == "j")

ggplot(data = j_hares, aes(x = hindft, y = weight)) +geom_point()+
  geom_smooth(method = "lm", se = FALSE, color = "gray30") +
  theme_minimal() +
  labs(x = "Hind Foot Length (mm)",
       y = "Weight (g)")
```

```{r, include = FALSE}
juv_hare_lm <- lm(weight ~ hindft, data = j_hares)

juv_hare_lm_tidy <- tidy(juv_hare_lm)
juv_hare_lm_glance <- glance(juv_hare_lm)

juv_hare_cor <- cor.test(j_hares$weight, j_hares$hindft)

juv_hare_cor_tidy <- tidy(juv_hare_cor)



juv_hare_lm
juv_hare_lm_tidy
juv_hare_lm_glance
juv_hare_cor
juv_hare_cor_tidy
```

**Figure 3.** Relationship between hind foot length (mm) and weight (g) for juvenile snowshoe hare. Points indicate individual hare measurements. Linear model summary: $\beta$~1~ = `r round(juv_hare_lm_tidy$estimate[2], 2)` g mm^-1^, p < 0.001, R^2^ = `r round(juv_hare_lm_glance$r.squared,2)`, Pearson's *r* = `r round(juv_hare_cor_tidy$estimate,2)`). 
Data: Kielland, Chapin, Ruess (2017).

The relationship between hind foot length and weight does not appear extremely linear (Figure 3). Simple linear regression revealed that the length of the hind foot does significantly predict juvenile hare weight (p < 0.001, R^2^ = `r round(juv_hare_lm_glance$r.squared,2)`) with an average slope of $\beta$ = `r round(juv_hare_lm_tidy$estimate[2], 2)` g mm^-1^ (i.e., for each one millimeter increase in hind foot length we expect an average increase in body weight of `r round(juv_hare_lm_tidy$estimate[2], 2)` g). The Pearson's *r* = `r round(juv_hare_cor_tidy$estimate,2)`, which means `r round(juv_hare_cor_tidy$estimate * 100,2)` percent of variance in the weight is predictable from the hind foot length (a weakly positive correlation).  The p < 0.001.  The data is homoscedastic.


## Summary

...

## Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14 


